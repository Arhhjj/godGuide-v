{"version":3,"sources":["assets\\scripts\\common\\cmpt\\ui\\i18n\\I18nLabel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { EventName } from \"../../../const/EventName\";\r\nimport { eventsOnLoad, preloadEvent } from \"../../../util/Events\";\r\nimport I18n from \"../../../util/I18n\";\r\n\r\nconst { ccclass, property, executeInEditMode, menu } = cc._decorator;\r\n\r\n@ccclass\r\n@eventsOnLoad()\r\n@executeInEditMode\r\n@menu(\"Framework/I18N/I18nLabel\")\r\nexport default class I18nLabel extends cc.Component {\r\n    @property(cc.String) private _textKey: string = \"\";\r\n\r\n    @property({ type: cc.String, tooltip: \"i18n key\" })\r\n    public get textKey(): string { return this._textKey; }\r\n    public set textKey(key: string) {\r\n        this._textKey = key;\r\n        this.updateLabel();\r\n    }\r\n\r\n    /**\r\n     * 用于正则替换的配置\r\n     */\r\n    private _option: { [k: string]: string | number } | Array<string | number> = [];\r\n\r\n    private _label: cc.Label | cc.RichText = null;\r\n    public get label(): cc.Label | cc.RichText {\r\n        if (!this._label) {\r\n            this._label = this.node.getComponent(cc.Label) || this.node.getComponent(cc.RichText);\r\n            if (!this._label) {\r\n                cc.error(\"Failed to update localized label, label component is invalid!\");\r\n                return null;\r\n            }\r\n        }\r\n        return this._label;\r\n    }\r\n\r\n    protected onLoad(): void {\r\n        try {\r\n            I18n.init();\r\n            this.updateLabel();\r\n        } catch (err) {\r\n            cc.error(err);\r\n        }\r\n    }\r\n\r\n    protected update(): void {\r\n        if (CC_EDITOR) {\r\n            if (this.label.string) {\r\n                let key = I18n.getKeyByValue(this.label.string);\r\n                if (key) {\r\n                    this.textKey = key;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新语言\r\n     */\r\n    @preloadEvent(EventName.UPDATE_LOCALIZED_CMPT)\r\n    public updateLabel(): void {\r\n        let localizedString = this._option instanceof Array ? I18n.getText(this._textKey, ...this._option) : I18n.getText(this._textKey, this._option);\r\n        if (localizedString) {\r\n            this.label.string = localizedString;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置语言与配置\r\n     * @param key\r\n     * @param option\r\n     */\r\n    public setTextKeyAndOption(key: string, ...option: [{ [k: string]: string | number }] | Array<string | number>): void {\r\n        this._textKey = key;\r\n        this.setOption(...option);\r\n    }\r\n\r\n    /**\r\n     * 仅设置配置\r\n     * @param option\r\n     */\r\n    public setOption(...option: [{ [k: string]: string | number }] | Array<string | number>): void {\r\n        if (option.length === 1 && Object.prototype.toString.call(option[0]) === \"[object Object]\") {\r\n            this._option = option[0] as { [k: string]: string | number };\r\n        } else {\r\n            this._option = option as Array<string | number>;\r\n        }\r\n        this.updateLabel();\r\n    }\r\n\r\n    /**\r\n     * 清除key\r\n     */\r\n    public clear(): void {\r\n        this.label.string = \"\";\r\n        this.textKey = \"\";\r\n    }\r\n}\r\n"]}