{"version":3,"sources":["assets\\scripts\\common\\cmpt\\ui\\button\\ButtonSingle.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property, menu, requireComponent } = cc._decorator;\r\n\r\n/**\r\n * 按钮组数据\r\n */\r\ninterface GroupData {\r\n    /** 该组是否锁定，同组按钮被触摸时进入锁定状态 */\r\n    lock: boolean;\r\n    /** 同组按钮 */\r\n    buttonSet: Set<cc.Button>;\r\n}\r\n\r\n/**\r\n * 按钮分组\r\n */\r\nenum ButtonGroup {\r\n    DEFAULT,\r\n    GROUP1,\r\n    GROUP2,\r\n}\r\n\r\n/**\r\n * 防多点触摸的按钮，同组按钮同一时刻只会有一个生效\r\n */\r\n@ccclass\r\n@requireComponent(cc.Button)\r\n@menu(\"Framework/UI组件/ButtonSingle\")\r\nexport default class ButtonSingle extends cc.Component {\r\n    @property({ type: cc.Enum(ButtonGroup), tooltip: CC_DEV && \"按钮分组，同组按钮同一时刻只会有一个生效\" })\r\n    public buttonGroup: ButtonGroup = ButtonGroup.DEFAULT;\r\n\r\n    /** 记录所有绑定该组件的按钮数据 */\r\n    private static _groupMap: Map<ButtonGroup, GroupData> = null;\r\n    private static get groupMap(): Map<ButtonGroup, GroupData> {\r\n        if (this._groupMap === null) {\r\n            this._groupMap = new Map();\r\n        }\r\n        return this._groupMap;\r\n    }\r\n\r\n    private _button: cc.Button = null;\r\n\r\n    protected onLoad(): void {\r\n        this._button = this.getComponent(cc.Button);\r\n        let groupData: GroupData = ButtonSingle.groupMap.get(this.buttonGroup);\r\n        if (groupData === undefined) {\r\n            groupData = {\r\n                lock: false,\r\n                buttonSet: new Set()\r\n            };\r\n            ButtonSingle.groupMap.set(this.buttonGroup, groupData);\r\n        }\r\n        groupData.buttonSet.add(this._button);\r\n\r\n        // 监听触摸事件\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        let groupData: GroupData = ButtonSingle.groupMap.get(this.buttonGroup);\r\n        if (groupData === undefined) {\r\n            cc.error(`[ButtonSingle.onDestroy] 数据异常 ButtonGroup: ${this.buttonGroup}`);\r\n            return;\r\n        }\r\n        groupData.buttonSet.delete(this._button);\r\n        this.unlock(groupData);\r\n    }\r\n\r\n    private onTouchStart(event: cc.Event.EventTouch): void {\r\n        let groupData: GroupData = ButtonSingle.groupMap.get(this.buttonGroup);\r\n        if (groupData === undefined) {\r\n            cc.error(`[ButtonSingle.onTouchStart] 数据异常 ButtonGroup: ${this.buttonGroup}`);\r\n            return;\r\n        }\r\n\r\n        if (groupData.lock) {\r\n            return;\r\n        }\r\n        groupData.lock = true;\r\n        groupData.buttonSet.forEach((e) => {\r\n            e.enabled = (e === this._button);\r\n        });\r\n    }\r\n\r\n    private onTouchEnd(event: cc.Event.EventTouch): void {\r\n        let groupData: GroupData = ButtonSingle.groupMap.get(this.buttonGroup);\r\n        if (groupData === undefined) {\r\n            cc.error(`[ButtonSingle.onTouchEnd] 数据异常 ButtonGroup: ${this.buttonGroup}`);\r\n            return;\r\n        }\r\n\r\n        this.unlock(groupData);\r\n    }\r\n\r\n    /**\r\n     * 当前按钮松开或销毁时解除同组按钮锁定状态\r\n     */\r\n    private unlock(groupData: GroupData): void {\r\n        if (groupData.lock && this._button.enabled) {\r\n            groupData.lock = false;\r\n            groupData.buttonSet.forEach((e) => {\r\n                e.enabled = true;\r\n            });\r\n        }\r\n    }\r\n}\r\n"]}