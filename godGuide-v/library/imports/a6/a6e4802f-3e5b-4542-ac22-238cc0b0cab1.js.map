{"version":3,"sources":["assets\\scripts\\common\\cmpt\\base\\Layer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { ResUrl } from \"../../const/Url\";\r\nimport Res from \"../../util/Res\";\r\nimport Tool from \"../../util/Tool\";\r\nimport DialogBase from \"./DialogBase\";\r\nimport Tip from \"./Tip\";\r\n\r\nconst { ccclass, property, disallowMultiple, menu } = cc._decorator;\r\n\r\n/**\r\n * tip数据\r\n */\r\nexport interface TipData {\r\n    /** 文字内容 */\r\n    text: string;\r\n    /** 此条文字是否唯一显示 */\r\n    unique?: boolean;\r\n    /** 存在时间 单位s */\r\n    duration?: number;\r\n    /** 消失时的渐隐时间 单位s */\r\n    fade?: number;\r\n    /** 初始位置 */\r\n    start?: cc.Vec2;\r\n    /** 渐隐过程终点位置 */\r\n    end?: cc.Vec2;\r\n}\r\n\r\n/**\r\n * 全局弹窗管理器\r\n */\r\n@ccclass\r\n@disallowMultiple\r\n@menu(\"Framework/基础组件/Layer\")\r\nexport default class Layer extends cc.Component {\r\n    public static inst: Layer = null;\r\n\r\n    @property(cc.Node) private mainLayer: cc.Node = null;\r\n    @property(cc.Node) private dialogLayer: cc.Node = null;\r\n    @property(cc.Node) private loadingLayer: cc.Node = null;\r\n    @property(cc.Node) private tipLayer: cc.Node = null;\r\n\r\n    /** 打开Loading层计数，为0时关闭，防止某些情况同时触发打开关闭Loading */\r\n    private _loadingCount: number = 0;\r\n    /** tip节点池 */\r\n    private _tipPool: cc.Node[] = [];\r\n    /** 当前存在的tip文字数组 */\r\n    private _tipTexts: string[] = [];\r\n\r\n    protected resetInEditor(): void {\r\n        if (!CC_EDITOR) {\r\n            return;\r\n        }\r\n        let checkNode = (...names: string[]) => {\r\n            names.forEach((name) => {\r\n                if (!this.node.getChildByName(name)) {\r\n                    let node = new cc.Node(name);\r\n                    this.node.addChild(node);\r\n                    let widget = node.addComponent(cc.Widget);\r\n                    widget.top = 0;\r\n                    widget.isAlignTop = true;\r\n                    widget.bottom = 0;\r\n                    widget.isAlignBottom = true;\r\n                    widget.left = 0;\r\n                    widget.isAlignLeft = true;\r\n                    widget.right = 0;\r\n                    widget.isAlignRight = true;\r\n                    if (name === \"LoadingLayer\") {\r\n                        node.addComponent(cc.BlockInputEvents);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        checkNode(\"MainLayer\", \"DialogLayer\", \"LoadingLayer\", \"TipLayer\");\r\n        this.mainLayer = this.node.getChildByName(\"MainLayer\");\r\n        this.dialogLayer = this.node.getChildByName(\"DialogLayer\");\r\n        this.loadingLayer = this.node.getChildByName(\"LoadingLayer\");\r\n        this.tipLayer = this.node.getChildByName(\"TipLayer\");\r\n    }\r\n\r\n    protected onLoad(): void {\r\n        Layer.inst = this;\r\n        this.hideLoading();\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        Layer.inst = null;\r\n    }\r\n\r\n    /**\r\n     * 获取文件名（截取url最后一个斜杠后的内容）\r\n     */\r\n    public getNameByUrl(url: string): string {\r\n        return url.substring(url.lastIndexOf(\"/\") + 1, url.length);\r\n    }\r\n\r\n    /**\r\n     * 进入新场景\r\n     * @async\r\n     * @param sceneName 场景名\r\n     */\r\n    public async enterScene(sceneName: string): Promise<void> {\r\n        this.showLoading();\r\n        cc.director.preloadScene(sceneName, (err) => {\r\n            if (err) {\r\n                cc.error(`[Layer.enterScene] failed to preload scene: ${sceneName}`);\r\n                return;\r\n            }\r\n            this.hideLoading();\r\n            cc.director.loadScene(sceneName);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 进入常驻界面，并清空dialog与tip（不同于dialog，常驻界面始终显示在最底层，且同时只会存在一个）\r\n     */\r\n    public async enterMain(url: string): Promise<cc.Node | null> {\r\n        this.showLoading();\r\n        let prefab: cc.Prefab = Res.get(url, cc.Prefab) || await Res.load(url, cc.Prefab);\r\n        this.hideLoading();\r\n        if (!prefab) {\r\n            cc.error(`[Layer.enterMain] can not find prefab: ${url}`);\r\n            return null;\r\n        }\r\n\r\n        this.mainLayer.destroyAllChildren();\r\n        this.closeDialogs();\r\n        this.clearTips();\r\n        let node: cc.Node = Res.instantiate(prefab);\r\n        node.setPosition(0, 0);\r\n        this.mainLayer.addChild(node);\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     * 获取弹窗组件（返回遍历到的第一个）\r\n     * @param url prefab路径，规则同Res加载路径\r\n     */\r\n    public getDialog(url: string): DialogBase {\r\n        for (let i = 0; i < this.dialogLayer.childrenCount; i++) {\r\n            let node = this.dialogLayer.children[i];\r\n            let cmpt = node.getComponent(DialogBase);\r\n            if (!cmpt) {\r\n                continue;\r\n            }\r\n            if (cmpt.prefabUrl === url) {\r\n                return cmpt;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * （同步方法，需确保事先已加载预制资源）打开弹窗\r\n     * @param url prefab路径，规则同Res加载路径\r\n     * @param args DialogBase.open调用参数\r\n     */\r\n    public openDialog(url: string, ...args: any[]): void {\r\n        let prefab: cc.Prefab = Res.get(url, cc.Prefab);\r\n        if (!prefab) {\r\n            cc.error(`[Layer.openDialog] can not find dialog prefab: ${url}`);\r\n            return;\r\n        }\r\n\r\n        let node = Res.instantiate(prefab);\r\n        this.dialogLayer.addChild(node);\r\n        node.setPosition(0, 0);\r\n        let cmpt = node.getComponent(DialogBase);\r\n        if (cmpt) {\r\n            //@ts-ignore\r\n            cmpt._prefabUrl = url;\r\n            cmpt.playOpen();\r\n            cmpt.onOpen(...args);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * （同步方法，需确保事先已加载预制资源）打开唯一弹窗--同一弹窗节点只能同时存在一个\r\n     * @param url prefab路径，规则同Res加载路径\r\n     * @param args DialogBase.open调用参数\r\n     */\r\n    public openUniDialog(url: string, ...args: any[]): void {\r\n        if (this.getDialog(url)) {\r\n            return;\r\n        }\r\n\r\n        this.openDialog(url, ...args);\r\n    }\r\n\r\n    /**\r\n     * 打开弹窗\r\n     * @async\r\n     * @param url prefab路径，规则同Res加载路径\r\n     * @param args DialogBase.open调用参数\r\n     */\r\n    public async openDialogAsync(url: string, ...args: any[]): Promise<void> {\r\n        this.showLoading();\r\n        let prefab: cc.Prefab = await Res.load(url, cc.Prefab);\r\n        this.hideLoading();\r\n        if (!prefab) {\r\n            cc.error(`[Layer.openDialogAsync] can not find dialog prefab: ${url}`);\r\n            return;\r\n        }\r\n\r\n        let node = Res.instantiate(prefab);\r\n        this.dialogLayer.addChild(node);\r\n        node.setPosition(0, 0);\r\n        let cmpt = node.getComponent(DialogBase);\r\n        if (cmpt) {\r\n            //@ts-ignore\r\n            cmpt._prefabUrl = url;\r\n            cmpt.playOpen();\r\n            cmpt.onOpen(...args);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 打开唯一弹窗--同一弹窗节点只能同时存在一个\r\n     * @async\r\n     * @param url prefab路径，规则同Res加载路径\r\n     * @param args DialogBase.open调用参数\r\n     */\r\n    public async openUniDialogAsync(url: string, ...args: any[]): Promise<void> {\r\n        if (this.getDialog(url)) {\r\n            return;\r\n        }\r\n\r\n        await this.openDialogAsync(url, ...args);\r\n    }\r\n\r\n    /**\r\n     * 关闭遍历到的第一个弹窗\r\n     * @param url prefab路径，规则同Res加载路径\r\n     * @param play true：调用playClose播放弹窗关闭动画；false：直接调用close关闭弹窗\r\n     */\r\n    public closeDialog(url: string, play: boolean = false): void {\r\n        let cmpt = this.getDialog(url);\r\n        if (!cmpt) {\r\n            return;\r\n        }\r\n        play ? cmpt.playClose() : cmpt.close();\r\n    }\r\n\r\n    /**\r\n     * 关闭所有同路径弹窗，不传参则关闭所有弹窗\r\n     * @param url prefab路径，规则同Res加载路径\r\n     * @param play true：调用playClose播放弹窗关闭动画；false：直接调用close关闭弹窗\r\n     */\r\n    public closeDialogs(url: string = \"\", play: boolean = false): void {\r\n        for (let i = this.dialogLayer.childrenCount - 1; i >= 0; i--) {\r\n            let node = this.dialogLayer.children[i];\r\n            let cmpt = node.getComponent(DialogBase);\r\n            if (!cmpt) {\r\n                continue;\r\n            }\r\n            if (!url || cmpt.prefabUrl === url) {\r\n                play ? cmpt.playClose() : cmpt.close();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 异步等待弹窗关闭（只等待遍历到的第一个）\r\n     * @param url prefab路径，规则同Res加载路径\r\n     */\r\n    public async waitCloseDialog(url: string): Promise<void> {\r\n        let cmpt = this.getDialog(url);\r\n        if (!cmpt) {\r\n            return;\r\n        }\r\n        return await new Promise((resolve, reject) => {\r\n            cmpt.addResolve(resolve);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 异步等待所有同路径弹窗关闭\r\n     * @param url prefab路径，规则同Res加载路径\r\n     */\r\n    public async waitCloseDialogs(url: string): Promise<void[]> {\r\n        let arr: Array<Promise<void>> = [];\r\n        for (let i = 0; i < this.dialogLayer.childrenCount; i++) {\r\n            let node = this.dialogLayer.children[i];\r\n            let cmpt = node.getComponent(DialogBase);\r\n            if (!cmpt) {\r\n                continue;\r\n            }\r\n            if (cmpt.prefabUrl === url) {\r\n                arr.push(new Promise((resolve, reject) => {\r\n                    cmpt.addResolve(resolve);\r\n                }));\r\n            }\r\n        }\r\n        return await Promise.all(arr);\r\n    }\r\n\r\n    /**\r\n     * 弹出一条文字提示\r\n     * @param data TipData | string 提示数据\r\n     */\r\n    public async showTip(data: TipData | string): Promise<void> {\r\n        // 处理tipData默认值\r\n        let tipData: TipData = null;\r\n        if (typeof data === \"string\") {\r\n            tipData = {\r\n                text: data\r\n            };\r\n        } else {\r\n            tipData = data;\r\n        }\r\n        if (!tipData.hasOwnProperty(\"unique\")) {\r\n            tipData.unique = false;\r\n        }\r\n        if (!tipData.hasOwnProperty(\"duration\")) {\r\n            tipData.duration = 1;\r\n        }\r\n        if (!tipData.hasOwnProperty(\"fade\")) {\r\n            tipData.fade = 0.5;\r\n        }\r\n        if (!tipData.hasOwnProperty(\"start\")) {\r\n            tipData.start = cc.v2(0, 0);\r\n        }\r\n        if (!tipData.hasOwnProperty(\"end\")) {\r\n            tipData.end = cc.v2(0, 0);\r\n        }\r\n\r\n        // 唯一显示\r\n        if (tipData.unique && Tool.arrayHas(this._tipTexts, tipData.text)) {\r\n            return;\r\n        }\r\n        this._tipTexts.push(tipData.text);\r\n\r\n        // 获取节点\r\n        let tipNode: cc.Node = null;\r\n        if (this._tipPool.length > 0) {\r\n            tipNode = this._tipPool.shift();\r\n        } else {\r\n            let prefab: cc.Prefab = await Res.load(ResUrl.PREFAB.TIP, cc.Prefab);\r\n            if (!prefab) {\r\n                cc.error(`[Layer.showTip] can not load prefab: ${ResUrl.PREFAB.TIP}`);\r\n                return;\r\n            }\r\n            tipNode = Res.instantiate(prefab);\r\n            this.tipLayer.addChild(tipNode);\r\n        }\r\n\r\n        // 动画\r\n        let delay = cc.delayTime(tipData.duration);\r\n        let fade = cc.fadeOut(tipData.fade);\r\n        let moveTo = cc.moveTo(tipData.fade, tipData.end);\r\n        let call = cc.callFunc(() => {\r\n            tipNode.active = false;\r\n            this._tipPool.push(tipNode);\r\n            Tool.arrayDelete(this._tipTexts, tipData.text);\r\n        });\r\n        tipNode.active = true;\r\n        tipNode.opacity = 255;\r\n        tipNode.setPosition(tipData.start);\r\n        tipNode.setSiblingIndex(this.tipLayer.childrenCount - 1);\r\n        tipNode.runAction(cc.sequence(delay, cc.spawn(fade, moveTo), call));\r\n\r\n        // 数据\r\n        tipNode.getComponent(Tip)?.init(tipData.text);\r\n    }\r\n\r\n    /**\r\n     * 清空所有提示\r\n     */\r\n    public clearTips(): void {\r\n        this._tipPool.length = 0;\r\n        this._tipTexts.length = 0;\r\n        this.tipLayer.destroyAllChildren();\r\n    }\r\n\r\n    /**\r\n     * 打开全局loading遮罩（打开与关闭的调用必须一一对应）\r\n     */\r\n    public showLoading(): void {\r\n        this._loadingCount++;\r\n        if (!this.loadingLayer.active) {\r\n            this.loadingLayer.active = true;\r\n            // 默认0.5s后才显示loading内容\r\n            let content = this.loadingLayer.getChildByName(\"content\");\r\n            if (content) {\r\n                content.active = false;\r\n                this.unscheduleAllCallbacks();\r\n                Tool.waitCmpt(this, 0.5).then(() => {\r\n                    content.active = true;\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 关闭全局loading遮罩\r\n     */\r\n    public hideLoading(): void {\r\n        this._loadingCount--;\r\n        if (this._loadingCount <= 0) {\r\n            this._loadingCount = 0;\r\n            this.loadingLayer.active = false;\r\n            this.unscheduleAllCallbacks();\r\n        }\r\n    }\r\n}\r\n"]}