{"version":3,"sources":["assets\\scripts\\common\\cmpt\\ui\\scrollList\\CircleList.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Tool from \"../../../util/Tool\";\r\n\r\nconst { ccclass, property, executeInEditMode, menu } = cc._decorator;\r\n\r\n/** 初始角度 */\r\nconst INIT_DEGREE: number = 270;\r\n\r\n/**\r\n * 环形列表，将节点以椭圆排列\r\n */\r\n@ccclass\r\n@executeInEditMode\r\n@menu(\"Framework/UI组件/CircleList\")\r\nexport default class CircleList extends cc.Component {\r\n    @property(cc.Node)\r\n    private content: cc.Node = null;\r\n    @property({ tooltip: CC_DEV && \"椭圆长短轴\" })\r\n    private ellipseAxes: cc.Vec2 = cc.v2(0, 0);\r\n    @property({ tooltip: CC_DEV && \"列表自动滚动的速度\" })\r\n    private scrollSpeed: number = 200;\r\n\r\n    private _init: boolean = false;\r\n    private _curDegree: number = INIT_DEGREE;\r\n    private _targetDegree: number = INIT_DEGREE;\r\n    private _scrolling: boolean = false;\r\n    private _itemDegreeMap: Map<cc.Node, number> = new Map();\r\n    private _maxDelta: number = 0;\r\n    /** 子节点被选中时的回调 */\r\n    private _selectCall: (item: cc.Node) => void = null;\r\n\r\n    /** 虚拟角度，子节点会根据角度计算坐标 */\r\n    public get curDegree(): number { return this._curDegree; }\r\n    public set curDegree(v: number) {\r\n        this._curDegree = Tool.normalizeDegree(v);\r\n        this.refreshItems();\r\n    }\r\n\r\n    /**\r\n     * 初始化列表，按角度均匀排列content所有子节点\r\n     * @param selectCall \r\n     */\r\n    public init(selectCall: (item: cc.Node) => void = null): void {\r\n        this._init = true;\r\n        this._scrolling = false;\r\n        this._maxDelta = 0;\r\n        this._itemDegreeMap.clear();\r\n        this._selectCall = selectCall;\r\n        if (this.content.childrenCount <= 0) {\r\n            return;\r\n        }\r\n        let average: number = 360 / this.content.childrenCount;\r\n        this.content.children.forEach((v, i) => {\r\n            this._itemDegreeMap.set(v, i * average);\r\n\r\n            v.on(cc.Node.EventType.TOUCH_MOVE, this.itemTouchMove, this);\r\n            v.on(cc.Node.EventType.TOUCH_END, this.itemTouchEnd, this);\r\n            v.on(cc.Node.EventType.TOUCH_CANCEL, this.itemTouchEnd, this);\r\n        });\r\n        this.refreshItems();\r\n    }\r\n\r\n    /**\r\n     * 滚动到指定子节点处\r\n     * @param item 子节点\r\n     */\r\n    public scrollToItem(item: cc.Node): void {\r\n        if (!this._itemDegreeMap.has(item)) {\r\n            return;\r\n        }\r\n\r\n        let itemDegree = this._itemDegreeMap.get(item);\r\n        let delta = INIT_DEGREE - itemDegree;\r\n        this._targetDegree = Tool.normalizeDegree(delta);\r\n        this._scrolling = true;\r\n        this._selectCall?.(item);\r\n    }\r\n\r\n    private refreshItems(): void {\r\n        this.content.children.forEach((v, i) => {\r\n            let degree = Tool.normalizeDegree(this._itemDegreeMap.get(v) + this.curDegree);\r\n            let pos = Tool.getEllipsePoint(this.ellipseAxes.x, this.ellipseAxes.y, degree);\r\n            v.setPosition(pos);\r\n            v.zIndex = -v.y;\r\n        });\r\n    }\r\n\r\n    protected update(dt: number): void {\r\n        if (!this._init || !this._scrolling || this.curDegree === this._targetDegree) {\r\n            return;\r\n        }\r\n\r\n        let delta = Math.abs(this._targetDegree - this.curDegree);\r\n        let degree = this.curDegree;\r\n        let sign = (delta < 180 ? 1 : -1) * Math.sign(this._targetDegree - this.curDegree);\r\n        degree += dt * this.scrollSpeed * sign;\r\n\r\n        if ((this.curDegree > this._targetDegree && degree < this._targetDegree) || (this.curDegree < this._targetDegree && degree > this._targetDegree)) {\r\n            degree = this._targetDegree;\r\n            this._scrolling = false;\r\n        }\r\n        this.curDegree = degree;\r\n    }\r\n\r\n    private itemTouchMove(event: cc.Event.EventTouch): void {\r\n        let delta = event.getDeltaX();\r\n        if (Math.abs(delta) < 1) {\r\n            return;\r\n        }\r\n\r\n        if (this._maxDelta < Math.abs(delta)) {\r\n            this._maxDelta = Math.abs(delta);\r\n        }\r\n        this.curDegree = this.curDegree + delta / 5;\r\n    }\r\n\r\n    private itemTouchEnd(event: cc.Event.EventTouch): void {\r\n        let node = event.target;\r\n        if (this._maxDelta < 5) {\r\n            this._maxDelta = 0;\r\n            this.scrollToItem(node);\r\n            return;\r\n        }\r\n\r\n        let minDelta = 360;\r\n        let minNode = this.content.children[0];\r\n        for (let i = 0; i < this.content.children.length; i++) {\r\n            const item = this.content.children[i];\r\n            let itemDegree = Tool.normalizeDegree(this._itemDegreeMap.get(item) + this.curDegree);\r\n            let delta = Math.abs(INIT_DEGREE - itemDegree);\r\n            if (delta > 180) {\r\n                delta = itemDegree + 360 - INIT_DEGREE;\r\n            }\r\n            if (delta < minDelta) {\r\n                minDelta = delta;\r\n                minNode = item;\r\n            }\r\n        }\r\n        this._maxDelta = 0;\r\n        this.scrollToItem(minNode);\r\n    }\r\n}\r\n"]}