{"version":3,"sources":["assets\\scripts\\common\\cmpt\\ui\\animValue\\AnimValue.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Easing, SCALE_TWEEN, Tween } from \"../../../util/Tween\";\r\n\r\nconst { ccclass, property, menu, executeInEditMode } = cc._decorator;\r\n\r\n/**\r\n * 数值变化类型\r\n */\r\nenum AnimType {\r\n    /** 以速度计算变化时长 */\r\n    SPEED,\r\n    /** 固定时长 */\r\n    DURATION,\r\n}\r\n\r\n/**\r\n * 固定时长时的缓动类型\r\n */\r\nenum EasingType {\r\n    NONE,\r\n    IN,\r\n    OUT,\r\n    IN_OUT,\r\n}\r\n\r\n/**\r\n * 数值渐变组件基类，可根据此组件拓展各种数值渐变的组件\r\n */\r\n@ccclass\r\n@executeInEditMode\r\n@menu(\"Framework/UI组件/AnimValue\")\r\nexport default class AnimValue extends cc.Component {\r\n    @property private _endValue: number = 0;\r\n    @property private _curValue: number = 0;\r\n\r\n    @property({\r\n        tooltip: CC_DEV && \"初始值\"\r\n    })\r\n    private get initValue(): number { return this._endValue; }\r\n    private set initValue(v: number) {\r\n        this._curValue = v;\r\n        this._endValue = v;\r\n        this.setValueImmediately(this._endValue);\r\n    }\r\n\r\n    @property({\r\n        type: cc.Enum(AnimType),\r\n        tooltip: CC_DEV && \"数值变化类型\\nSPEED：以速度计算变化时长\\nDURATION：固定时长\"\r\n    })\r\n    public animType: AnimType = AnimType.SPEED;\r\n\r\n    @property({\r\n        tooltip: CC_DEV && \"每秒数值变化速度\",\r\n        visible() { return this.animType === AnimType.SPEED; }\r\n    })\r\n    public speed: number = 1;\r\n\r\n    @property({\r\n        tooltip: CC_DEV && \"数值变化的总时长\",\r\n        visible() { return this.animType === AnimType.DURATION; }\r\n    })\r\n    public duration: number = 1;\r\n\r\n    @property({\r\n        type: cc.Enum(EasingType),\r\n        tooltip: CC_DEV && \"变化的缓动类型\"\r\n    })\r\n    public easingType: EasingType = EasingType.NONE;\r\n\r\n    @property({\r\n        tooltip: CC_DEV && \"变化速度是否受到timeScale的影响\"\r\n    })\r\n    public timeScale: boolean = false;\r\n\r\n    /** 缓存动画的resolve */\r\n    private _animResolve: (value: void | PromiseLike<void>) => void;\r\n    private _tween: Tween<this> = null;\r\n    private _isAdd: boolean = false;\r\n    /** 当前是否为增量变化 */\r\n    public get isAdd(): boolean { return this._isAdd; }\r\n\r\n    /** 变化的目标值 */\r\n    public get endValue(): number { return this._endValue; }\r\n    /** 变化过程的当前值 */\r\n    public get curValue(): number { return this._curValue; }\r\n\r\n    /**\r\n     * @virtual\r\n     */\r\n    protected onAnimStart(): void {\r\n    }\r\n\r\n    /**\r\n     * @virtual\r\n     */\r\n    protected onAnimUpdate(): void {\r\n    }\r\n\r\n    /**\r\n     * @virtual\r\n     */\r\n    protected onAnimComplete(): void {\r\n        if (this._animResolve) {\r\n            this._animResolve();\r\n            this._animResolve = null;\r\n        }\r\n        if (this._tween) {\r\n            this._tween.stop();\r\n            this._tween = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 立即设置value，不执行动画\r\n     * @virtual\r\n     */\r\n    protected setValueImmediately(end: number): void {\r\n        this._isAdd = this._endValue - this._curValue > 0;\r\n        this._endValue = end;\r\n        this._curValue = end;\r\n        this.onAnimStart();\r\n        this.onAnimUpdate();\r\n        this.onAnimComplete();\r\n    }\r\n\r\n    /**\r\n     * 设置进度值。进度动画结束后resolve\r\n     * @virtual\r\n     * @param end 目标进度值\r\n     * @param anim 是否执行动画，默认true\r\n     */\r\n    public setValue(end: number, anim: boolean = true): Promise<void> {\r\n        return new Promise((resolve, reject) => {\r\n            if (!anim) {\r\n                this.setValueImmediately(end);\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            this._animResolve = resolve;\r\n            this._endValue = end;\r\n            this._isAdd = this._endValue - this._curValue > 0;\r\n            this._tween?.stop();\r\n            this._tween = this.timeScale ? new Tween(this, SCALE_TWEEN) : new Tween(this);\r\n            let duration = this.animType === AnimType.DURATION ? this.duration : Math.abs(this._endValue - this._curValue) / this.speed;\r\n            switch (this.easingType) {\r\n                case EasingType.IN:\r\n                    this._tween.easing(Easing.Quadratic.In);\r\n                    break;\r\n                case EasingType.OUT:\r\n                    this._tween.easing(Easing.Quadratic.Out);\r\n                    break;\r\n                case EasingType.IN_OUT:\r\n                    this._tween.easing(Easing.Quadratic.InOut);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            this._tween.to({ _curValue: this._endValue }, duration * 1000)\r\n                .onStart(() => {\r\n                    this.onAnimStart();\r\n                })\r\n                .onUpdate(() => {\r\n                    this.onAnimUpdate();\r\n                })\r\n                .onComplete(() => {\r\n                    this.onAnimComplete();\r\n                })\r\n                .start();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 停止动画，并中止之前未结束的Promise\r\n     * @virtual\r\n     */\r\n    public stop(): void {\r\n        if (this._animResolve) {\r\n            this._animResolve = null;\r\n        }\r\n        if (this._tween) {\r\n            this._tween.stop();\r\n            this._tween = null;\r\n        }\r\n    }\r\n}\r\n"]}