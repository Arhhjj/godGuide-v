{"version":3,"sources":["assets\\scripts\\showcase\\home\\Card\\GameController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Layer from \"../../../common/cmpt/base/Layer\";\r\nimport { EventName } from \"../../../common/const/EventName\";\r\nimport { EGameStatus } from \"../../../common/runtime/EnumIndex\";\r\nimport UserInfo, { UserInfoStorge } from \"../../../common/runtime/UserInfo\";\r\nimport Events, { preloadEvent } from \"../../../common/util/Events\";\r\nimport Tool from \"../../../common/util/Tool\";\r\nimport BarrierManager from \"./BarrierManager\";\r\nimport MoveCtr from \"./MoveCtr\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GameController extends cc.Component {\r\n    @property(cc.Node) touchArea: cc.Node = null\r\n    @property(cc.Node) targetMove: cc.Node = null\r\n    @property(cc.Node) targetShow: cc.Node = null\r\n    private moveCtrCmpt: MoveCtr = null\r\n\r\n    @property(cc.Node) barrierArea: cc.Node = null\r\n    private barrierManagerCmpt: BarrierManager = null\r\n\r\n    private gameStatus: EGameStatus = EGameStatus.END\r\n    @property(cc.Node) dlgOver: cc.Node = null\r\n    private isOver: boolean = false //控制开始游戏的速度\r\n\r\n    protected onLoad(): void {\r\n        Events.targetOn(this)\r\n\r\n        this.moveCtrCmpt = new MoveCtr(this.targetMove, this.targetShow)\r\n        this.barrierManagerCmpt = new BarrierManager(this.barrierArea)\r\n        // this.startGame()\r\n    }\r\n\r\n    async startGame() {\r\n        if (this.isOver) return\r\n        this.isOver = true\r\n\r\n        this.gameStatus = EGameStatus.START\r\n        this.toggleDlgOver()\r\n\r\n        this.moveCtrCmpt.startMoving()\r\n        while (this.gameStatus === EGameStatus.START) {\r\n            this.barrierManagerCmpt.createBarrier()\r\n            await Tool.waitCmpt(this, 1)\r\n        }\r\n\r\n        this.isOver = false\r\n    }\r\n\r\n    /**改变移动方向 */\r\n    changeMoveDirection() {\r\n        if (this.gameStatus !== EGameStatus.START) return\r\n        this.moveCtrCmpt.changeMoveDirection()\r\n    }\r\n\r\n    @preloadEvent(EventName.JUDG_RESULT)\r\n    judgResult(barrierID: number) {\r\n        if (barrierID === 7) {\r\n            console.log(\"加道具数量\");\r\n            Layer.inst.showTip({ text: \"获得道具：金阳\", unique: false, end: cc.v2(0, 100) })\r\n            return\r\n        }\r\n\r\n        const targetID = this.moveCtrCmpt.targetID\r\n        if (barrierID === targetID) {\r\n            console.log(\"加点金币\");\r\n\r\n            const coin = Tool.randInt(20, 100)\r\n            UserInfo.instance.coin += coin\r\n            UserInfoStorge.setUserInfo()\r\n            Events.emit(EventName.UPDATE_COIN)\r\n\r\n            Layer.inst.showTip({ text: `获得${coin}金币`, unique: false, end: cc.v2(0, 100) })\r\n\r\n        } else {\r\n            console.log(\"gameOver\");\r\n            Layer.inst.showTip({ text: \"结束获取\", unique: false, end: cc.v2(0, 100) })\r\n\r\n            this.gameOver();\r\n        }\r\n    }\r\n\r\n    gameOver() {\r\n        this.gameStatus = EGameStatus.END\r\n        this.moveCtrCmpt.randomID()\r\n        this.moveCtrCmpt.gameOver()\r\n        this.barrierArea.destroyAllChildren()\r\n        this.toggleDlgOver()\r\n    }\r\n\r\n    toggleDlgOver() {\r\n        this.dlgOver.active = this.gameStatus === EGameStatus.END\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        Events.targetOff(this)\r\n        // this.moveCtrCmpt.onDestroy()\r\n    }\r\n\r\n}\r\n"]}