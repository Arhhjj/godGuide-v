{"version":3,"sources":["assets\\scripts\\showcase\\home\\Card\\CardCtr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { DirUrl } from \"../../../common/const/Url\";\r\nimport Res from \"../../../common/util/Res\";\r\nimport Card from \"./Card\";\r\nimport RecyclePool from \"../../../common/util/RecyclePool\"\r\nimport ResSprite from \"../../../common/cmpt/ui/res/ResSprite\";\r\nimport Tool from \"../../../common/util/Tool\";\r\nimport Events, { preloadEvent } from \"../../../common/util/Events\";\r\nimport { EventName } from \"../../../common/const/EventName\";\r\nimport GlobalInfo from \"../../../common/runtime/GlobalInfo\";\r\nimport UserInfo, { UserInfoStorge } from \"../../../common/runtime/UserInfo\";\r\nimport Layer from \"../../../common/cmpt/base/Layer\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nconst CARD_NUM = 5\r\n\r\n@ccclass\r\nexport default class CardCtr extends cc.Component {\r\n\r\n    @property(cc.Node) moveArea: cc.Node = null\r\n\r\n    private cardCmpts: Card[] = []\r\n    private cardRandoms: number[] = []\r\n\r\n    @property(cc.Node) targetNode: cc.Node = null\r\n    private targetNum: number = null\r\n\r\n    @property(cc.Node) clickArea: cc.Node = null\r\n    @property(cc.Node) playerNode: cc.Node = null\r\n    private targetPosition: cc.Vec2 = cc.Vec2.ZERO; // 玩家节点移动的目标位置\r\n    private moveSpeed: number = 200; // 玩家节点移动的速度\r\n\r\n    @property(cc.Node) gameStatusBtn: cc.Node = null\r\n    private gameStatus: string = \"end\"\r\n\r\n    protected onLoad() {\r\n        Events.targetOn(this);\r\n        this.clickArea.on(\"touchend\", this.onTouchEnd, this);\r\n    }\r\n\r\n    protected onDestroy() {\r\n        Events.targetOff(this);\r\n    }\r\n\r\n    onTouchEnd(event: cc.Event.EventTouch) {\r\n        if (this.gameStatus !== \"start\") return\r\n\r\n        const clickPos = event.getLocation(); // 获取点击的世界坐标位置\r\n        this.targetPosition = this.clickArea.convertToNodeSpaceAR(clickPos); // 将目标位置转换为相对于可点击区域的本地坐标\r\n\r\n        // 开始移动\r\n        this.movePlayerNode();\r\n    }\r\n\r\n    movePlayerNode() {\r\n        const v2 = cc.v2(this.playerNode.position.x, this.playerNode.position.y)\r\n        const distance = this.targetPosition.sub(v2).mag(); // 计算当前位置和目标位置的距离\r\n        const duration = distance / this.moveSpeed; // 计算移动所需的时间\r\n\r\n        this.playerNode.stopAllActions(); // 停止之前的移动动作\r\n        this.playerNode.runAction(cc.moveTo(duration, this.targetPosition)); // 执行移动动作\r\n    }\r\n\r\n    protected async startGame() {\r\n        if (UserInfo.instance.coin < 100) {\r\n            Layer.inst.showTip({ text: \"金币不足无法开启\", unique: true, end: cc.v2(0, 100) })\r\n            return\r\n        }\r\n        UserInfo.instance.coin -= 100\r\n        UserInfoStorge.setUserInfo()\r\n        Events.emit(EventName.UPDATE_COIN)\r\n\r\n        this.gameStatus = \"start\"\r\n        this.gameStatusBtn.active = this.gameStatus === \"end\"\r\n        GlobalInfo.ON_COLLISION_ENTER = true\r\n\r\n        await this.initCards()\r\n        this.setTarget()\r\n        this.cmptsInit()\r\n    }\r\n\r\n    /**初始化card -- cmpt -- spriteframe */\r\n    private initCards() {\r\n        return new Promise<void>(async (resolve, reject) => {\r\n            let index = 0\r\n            while (index++ < CARD_NUM) {\r\n                const prefab = await Res.load(DirUrl.PREFAB + \"home/card/Card\", cc.Prefab)\r\n                const card = Res.instantiate(prefab as cc.Prefab)\r\n                const cardCmpt = card.addComponent(Card)\r\n                card.setParent(this.moveArea)\r\n                const random = cardCmpt.initSpriteFrame()\r\n\r\n                this.cardCmpts.push(cardCmpt)\r\n                this.cardRandoms.push(await random)\r\n            }\r\n            resolve()\r\n        })\r\n    }\r\n\r\n    /**开始移动 */\r\n    cmptsInit() {\r\n        console.log(\">>> this.cardRandoms:\", this.cardRandoms);\r\n        this.cardCmpts.map(item => item.init())\r\n    }\r\n\r\n    /**设置目标 -- 在initCards初始化完成之后进行 */\r\n    async setTarget() {\r\n        const resSprite = this.targetNode.getComponent(ResSprite) || this.targetNode.addComponent(ResSprite)\r\n        const targetNum = Tool.arrayRand(this.cardRandoms)\r\n        const url = DirUrl.TEXTURE + `home/card${targetNum}`\r\n        await resSprite.setSpriteFrame(url)\r\n\r\n        this.targetNum = targetNum\r\n        console.log(\">>> this.targetNum:\", this.targetNum);\r\n    }\r\n\r\n    /**新增card */\r\n    async createCard() {\r\n        const prefab = await Res.load(DirUrl.PREFAB + \"home/card/Card\", cc.Prefab)\r\n        const card = Res.instantiate(prefab as cc.Prefab)\r\n        const cardCmpt = card.addComponent(Card)\r\n        card.setParent(this.moveArea)\r\n        const random = cardCmpt.initSpriteFrame()\r\n\r\n        this.cardRandoms.push(await random)\r\n\r\n        cardCmpt.init()\r\n    }\r\n\r\n    /**接触之后判断结果 */\r\n    // @preloadEvent(EventName.JUDG_CARD)\r\n    async judgResult(cardCmpt: Card, cardNode: cc.Node) {\r\n        cardCmpt.canMove = false\r\n        const random = cardCmpt.random\r\n        console.log(\">>> random:\", this.targetNum);\r\n        console.log(\">>> this.cardRandoms:\", this.cardRandoms);\r\n\r\n        cardNode.destroy()\r\n\r\n        const findIndex = this.cardRandoms.findIndex(index => index === random);\r\n        this.cardRandoms.splice(findIndex, 1)\r\n\r\n        if (random === this.targetNum) {\r\n            await this.createCard();\r\n            await this.setTarget();\r\n\r\n            //增加金币  \r\n            Events.emit(EventName.ADD_COIN)\r\n            GlobalInfo.ON_COLLISION_ENTER = true\r\n            return\r\n        }\r\n\r\n        //减一滴血什么的\r\n        Layer.inst.showTip({ text: \"错误目标\", unique: false, end: cc.v2(0, 100) })\r\n        // await Tool.waitCmpt(this, 0.5)\r\n        this.resetInfo()\r\n\r\n        // await this.createCard()\r\n        // GlobalInfo.ON_COLLISION_ENTER = true\r\n    }\r\n\r\n    resetInfo() {\r\n        GlobalInfo.ON_COLLISION_ENTER = false\r\n        this.moveArea.destroyAllChildren()\r\n\r\n        this.cardCmpts = []\r\n        this.cardRandoms = []\r\n\r\n        this.targetNum = null\r\n        this.targetPosition = cc.Vec2.ZERO\r\n\r\n        this.playerNode.stopAllActions();\r\n        this.playerNode.setPosition(0, -375)\r\n\r\n        this.gameStatus = \"end\"\r\n        this.gameStatusBtn.active = this.gameStatus === \"end\"\r\n    }\r\n\r\n}\r\n"]}