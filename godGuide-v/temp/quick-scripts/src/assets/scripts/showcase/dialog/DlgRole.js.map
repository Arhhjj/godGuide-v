{"version":3,"sources":["assets\\scripts\\showcase\\dialog\\DlgRole.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,gEAA2D;AAC3D,sDAAiD;AACjD,8CAAgD;AAChD,0DAAyE;AACzE,mDAA8C;AAC9C,+CAA0C;AAEpC,IAAA,KAA8B,EAAE,CAAC,UAAU,EAAzC,OAAO,aAAA,EAAE,QAAQ,cAAA,EAAE,IAAI,UAAkB,CAAC;AAGlD;IAAqC,2BAAU;IAA/C;QAAA,qEA8DC;QA3DsB,WAAK,GAAY,IAAI,CAAA;QACrB,UAAI,GAAY,IAAI,CAAA;;IA0D3C,CAAC;IAxDa,wBAAM,GAAhB;QACI,iBAAM,MAAM,WAAE,CAAC;QACf,gBAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IAC1B,CAAC;IAES,2BAAS,GAAnB;QACI,gBAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;IAC3B,CAAC;IAES,wBAAM,GAAhB,cAAqB,CAAC;IAEtB;;OAEG;IACI,wBAAM,GAAb;QACI,IAAI,CAAC,QAAQ,CAAC,kBAAQ,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;QACjE,IAAI,CAAC,QAAQ,CAAC,kBAAQ,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC;IAChF,CAAC;IAED;;;;;OAKG;IACH,0BAAQ,GAAR,UAAS,OAAiB,EAAE,SAAmB,EAAE,QAAiB;QAC9D,IAAM,UAAU,GAAG,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;QACrD,UAAU,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAC,IAAI,EAAE,KAAK;YACpC,IAAM,EAAE,GAAG,IAAI,CAAC,sBAAsB,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC;YACjD,EAAE,CAAC,MAAM,GAAM,OAAO,CAAC,KAAK,CAAC,SAAI,SAAS,CAAC,KAAK,CAAG,CAAC;YAEpD,kBAAkB;YAClB,WAAW;YACX,uCAAuC;YACvC,IAAI;QACR,CAAC,CAAC,CAAC;IACP,CAAC;IAED,yBAAO,GAAP;QAEI,IAAM,YAAY,GAAG;YACjB,IAAM,cAAc,GAAG,kBAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,UAAC,KAAK,IAAK,OAAA,KAAK,GAAG,CAAC,EAAT,CAAS,CAAC,CAAC;YAC/E,OAAO,CAAC,cAAc,CAAC;QAC3B,CAAC,CAAA;QAED,IAAI,CAAC,YAAY,EAAE,EAAE;YACjB,eAAK,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC,CAAA;YACxE,OAAM;SACT;QACD,eAAK,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC,CAAA;QAEtE,kBAAQ,CAAC,QAAQ,CAAC,UAAU,GAAG,kBAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,UAAC,IAAI,IAAK,OAAA,IAAI,GAAG,CAAC,EAAR,CAAQ,CAAC,CAAA;QACnF,kBAAQ,CAAC,QAAQ,CAAC,UAAU,GAAG,kBAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,UAAC,IAAI,IAAK,OAAA,IAAI,GAAG,cAAI,CAAC,OAAO,CAAC,EAAE,EAAE,GAAG,CAAC,EAA5B,CAA4B,CAAC,CAAA;QACvG,yBAAc,CAAC,WAAW,EAAE,CAAA;QAC5B,IAAI,CAAC,MAAM,EAAE,CAAA;IACjB,CAAC;IA5Da,YAAI,GAAW,YAAM,CAAC,aAAa,GAAG,SAAS,CAAC;IAE3C;QAAlB,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;0CAAsB;IACrB;QAAlB,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;yCAAqB;IAJtB,OAAO;QAD3B,OAAO;OACa,OAAO,CA8D3B;IAAD,cAAC;CA9DD,AA8DC,CA9DoC,oBAAU,GA8D9C;kBA9DoB,OAAO","file":"","sourceRoot":"/","sourcesContent":["import DialogBase from \"../../common/cmpt/base/DialogBase\";\r\nimport Layer from \"../../common/cmpt/base/Layer\";\r\nimport { DirUrl } from \"../../common/const/Url\";\r\nimport UserInfo, { UserInfoStorge } from \"../../common/runtime/UserInfo\";\r\nimport Events from \"../../common/util/Events\";\r\nimport Tool from \"../../common/util/Tool\";\r\n\r\nconst { ccclass, property, menu } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class DlgRole extends DialogBase {\r\n    public static pUrl: string = DirUrl.PREFAB_DIALOG + \"DlgRole\";\r\n\r\n    @property(cc.Node) props: cc.Node = null\r\n    @property(cc.Node) pers: cc.Node = null\r\n\r\n    protected onLoad() {\r\n        super.onLoad();\r\n        Events.targetOn(this);\r\n    }\r\n\r\n    protected onDestroy() {\r\n        Events.targetOff(this);\r\n    }\r\n\r\n    protected update() { }\r\n\r\n    /**\r\n     * @override\r\n     */\r\n    public onOpen() {\r\n        this.initInfo(UserInfo.instance.propConfig, [1, 1, 1, 1], false);\r\n        this.initInfo(UserInfo.instance.roleConfig, [9999, 9999, 9999, 9999], true);\r\n    }\r\n\r\n    /**\r\n     * 初始化属性和角色信息\r\n     * @param dataArr 属性/角色的数据数组\r\n     * @param maxValArr 最大值的数据数组（3000 或者 1）\r\n     * @param progress 是否需要初始化进度条（props 不需要，pers 需要）\r\n     */\r\n    initInfo(dataArr: number[], maxValArr: number[], progress: boolean) {\r\n        const parentNode = progress ? this.pers : this.props;\r\n        parentNode.children.forEach((item, index) => {\r\n            const lb = item.getComponentInChildren(cc.Label);\r\n            lb.string = `${dataArr[index]}/${maxValArr[index]}`;\r\n\r\n            // if (progress) {\r\n            // } else {\r\n            //     lb.string = `${dataArr[index]}`;\r\n            // }\r\n        });\r\n    }\r\n\r\n    upgrade() {\r\n\r\n        const propCheckout = () => {\r\n            const hasLessThanOne = UserInfo.instance.propConfig.some((value) => value < 1);\r\n            return !hasLessThanOne;\r\n        }\r\n\r\n        if (!propCheckout()) {\r\n            Layer.inst.showTip({ text: \"升级材料不足\", unique: true, end: cc.v2(0, 100) })\r\n            return\r\n        }\r\n        Layer.inst.showTip({ text: \"升级成功\", unique: true, end: cc.v2(0, 100) })\r\n\r\n        UserInfo.instance.propConfig = UserInfo.instance.propConfig.map((item) => item - 1)\r\n        UserInfo.instance.roleConfig = UserInfo.instance.roleConfig.map((item) => item + Tool.randInt(50, 200))\r\n        UserInfoStorge.setUserInfo()\r\n        this.onOpen()\r\n    }\r\n}\r\n\r\n\r\n\r\n"]}